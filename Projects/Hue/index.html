<!DOCTYPE HTML>
<html lang="en">
  
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Limelight|Flamenco|Federo|Yesteryear|Josefin Sans|Spinnaker|Sansita One|Handlee|Droid Sans|Oswald:400,300,700"
    media="screen" rel="stylesheet" type="text/css" />
    <style>
      /* No content under the fixed bootstrap header. */
      body {
        padding-top: 42px;
      }
    </style>
    <link href="css/bootstrap.css" media="screen" rel="stylesheet" type="text/css"/>
    <link href="css/bootstrap-datetimepicker.min.css" media="screen" rel="stylesheet" type="text/css"/>
    <link href="css/bootstrap-responsive.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="css/fontawesome.css" media="screen" rel="stylesheet" type="text/css"/>
    <link href="css/style.css" media="screen" rel="stylesheet" type="text/css"/>
    <!-- Typekit fonts require an account and a kit containing the fonts used.
    see https://typekit.com/plans for details. <script type="text/javascript"
    src="//use.typekit.net/YOUR_KIT_ID.js"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
-->
    <title>admin</title>
  </head>
  
  <body>
    <div id="absolute-wrapper">
      <label class="control-label control-label-1">Hue Group</label>
      <div class="row-fluid">
        <span class="span3">
          <span class="label"></span>
          <label class="control-label" id="device_name">Unnamed device</label>
        </span>
        <span class="span9">
          <div class="btn-toolbar">
            <div class="btn-group">
              <button class="btn btn-danger" id="onOff"> <i class="icon icon-off"></i> 
              </button>
            </div>
            <div class="btn-group">
              <button class="btn" id="btn_colour"> <i class="icon icon-tint"></i> 
              </button>
              <button class="btn" id="dash-1"> <i class="icon icon-dashboard"></i> 
              </button>
              <button class="btn" id="alarm"> <i class="icon icon-bell"></i> 
              </button>
              <button class="btn" id="settings"> <i class="icon icon-wrench"></i> 
              </button>
              <button id="schedule" class="btn"><i class="icon icon-calendar"></i>
			  </button>
            </div>
            <div class="btn-group">
              <button class="btn" id="btn_refresh"> <i class="icon icon-repeat"></i> 
              </button>
              <button class="btn"> <i class="icon icon-trash"></i> 
              </button>
            </div>
			  
          </div>
        </span>
      </div>
      <div class="dom-body-text paragraph" id="dom-elem-43">
        <p>This device is located in the center of the living room, above the couch.</p>
      </div>
    </div>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
      <a href="#" class="brand">Hue</a>
      <ul class="nav">
          <li><a href="#" class="a-1">Reports</a>
          </li>
          <li class="active"><a href="#">Bulbs</a>
          </li>
          <li><a href="#" class="a-1"> Inbox <span class="badge badge-important">2</span>                   </a>
          </li>
        </ul>
      </div>
    </div>
    <input id="booting" type="hidden" value="boot"/>
  </body>
  
    <script src="../../Libs/jQuery/jquery_1.8.2.js"></script>
    <script src="js/bootstrap-datetimepicker.min.js"></script>
    <script src="js/bootstrap.js"></script>
    
    <script type="text/javascript">
    
    var booting = ($("#booting").val() == 'boot');
    console.log(booting);
    
    	$(document).ready(function()
    	{
    		getConfig();
    	});
	  
    
    	$('#btn_refresh').click(function()
    	{
    	booting = true;
	    	getConfig();
    	});
    		
		function getConfig()
		{
			$.getJSON("http://192.168.0.7/api/<hue_key>/lights/3",
			function(data)
			{
				console.log(data);
				debugger;
 
				$.each(data, function(key, val) 
				{
					if(key === "name")
					{
						$("#device_name").text(val);
					}
					if(key === "state")
					{	
						$.each(val, function(state_key, state_val)
						{
							if(state_key === "on")
							{
									(booting === true) ? isOff(!state_val) : isOff(state_val);
							}
						});
					}
				});
				var json_parsed = $.parseJSON(data);//$.parseJSON('{"Users":[{"Name":"user999","Value":"test"},{"Name":"test2","Value":"test"}]}');
				booting = false;
			});
		};
		
		function SetOnOff(onOff)
		{
			$.ajax({
				url: 'http://192.168.0.7/api/<hue_key>/lights/3/state',
				type: 'PUT',
				success: getConfig(),
				data:'{"bri": 80, "on": '+onOff+'}'	
			});
			console.log('{"bri": 80, "on": '+onOff+'}');
		};
		
		function isOff(value){
			if(value===false) // bulb is on
			{
				$("#onOff").removeClass('btn-danger');
				$("#onOff").addClass('btn-success');
			}
			else
			{
				$("#onOff").removeClass('btn-success');
				$("#onOff").addClass('btn-danger');
			}
		};
		
		$('#onOff').click(function()
		{
			$.getJSON("http://192.168.0.7/api/<hue_key>/lights/3",
			function(data)
			{
				$.each(data, function(key, val) 
				{
					if(key === "state")
					{	
						$.each(val, function(state_key, state_val)
						{
							if(state_key === "on")
							{	
								console.log("onclick:"+state_val);
								if(state_val === true)
								{
									SetOnOff(false);
								}
								else
									SetOnOff(true);
							}
						});
					}
				});
			});
		});
		
		
		  </script>

</html>






